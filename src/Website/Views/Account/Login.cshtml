@using Kcesar.MissionLine.Website.Models
@using Microsoft.Owin.Security
@{
  ViewBag.Title = "Log in";
}

<h2>@ViewBag.Title.</h2>
@{
  var loginProviders = Context.GetOwinContext().Authentication.GetExternalAuthenticationTypes();
}
<div class="row">
  <div class="col-md-6">
    <h4>Log in using your ESAR Office 365 account.</h4>
    <hr />
    <p>When registered as a member of King County ESAR, an account is created for you in Microsoft's Office 365 system. This account will end in @@kcesar.org.</p>
    @using (Html.BeginForm("ExternalLogin", "Account", new { ReturnUrl = ViewBag.ReturnUrl }))
    {
      @Html.AntiForgeryToken()
      <div id="socialLoginList">
        <p>
          @foreach (AuthenticationDescription p in loginProviders.Where(f => f.Caption == "ESAR Office 365"))
          {
            <button type="submit" class="btn btn-default" name="provider" value="@p.AuthenticationType" title="Log in using your @p.Caption account">@p.AuthenticationType</button>
          }
        </p>
      </div>
    }
  </div>
  <div class="col-md-4">
    <section id="socialLoginForm">
      <h4>Use another service to log in.</h4>
      <hr />
      <p>Before using these logins you must register them by logging in with your ESAR Office 365 account (same as for the SharePoint site), then visit the @Html.ActionLink("Link Login", "Link") page.</p>
      @Html.Partial("_ExternalLoginsListPartial", new ExternalLoginListViewModel { ReturnUrl = ViewBag.ReturnUrl })
    </section>
  </div>
</div>